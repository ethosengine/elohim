@if (isVisible()) {
  <button
    type="button"
    [class]="'connection-indicator ' + status().cssClass"
    [title]="status().label"
    (click)="toggleExpanded()"
  >
    <!-- Status Dot -->
    <span class="status-dot" [style.backgroundColor]="status().color"></span>

    <!-- Icon -->
    <span
      class="material-icons status-icon"
      [class.spinning]="status().mode === 'connecting' || status().mode === 'reconnecting'"
    >
      {{ status().icon }}
    </span>

    <!-- Label (shown when not compact) -->
    <span class="status-label">{{ status().label }}</span>

    <!-- Peer count badge (when P2P peers connected) -->
    @if (status().peerCount && status().peerCount! > 0) {
      <span class="peer-count">
        {{ status().peerCount }} {{ status().peerCount === 1 ? 'peer' : 'peers' }}
      </span>
    }

    <!-- Doorway URL badge (hosted mode) -->
    @if (status().mode === 'hosted' && doorwayUrl()) {
      <span class="doorway-url-badge">{{ shortenUrl(doorwayUrl()!) }}</span>
    }

    <!-- Tooltip/Dropdown on hover -->
    @if (expanded) {
      <div class="status-tooltip">
        <div class="tooltip-header">
          <span class="material-icons">{{ status().icon }}</span>
          <span>{{ status().label }}</span>
        </div>
        <p class="tooltip-description">
          @switch (status().mode) {
            @case ('steward') {
              Connected to the P2P network via your local node.
            }
            @case ('local') {
              Local node running. Syncing will resume when peers are available.
            }
            @case ('hosted') {
              Connected via {{ status().doorwayName ?? 'doorway' }}. Hosted identity.
            }
            @case ('connecting') {
              Establishing connection to the network...
            }
            @case ('reconnecting') {
              Connection lost. Attempting to reconnect...
            }
            @case ('session') {
              You're exploring as a human in session. Your journey is saved locally.
            }
            @case ('offline') {
              @if (status().doorwayName) {
                Unable to reach {{ status().doorwayName }}. Some features may be limited.
              } @else {
                Not connected. Some features may be limited.
              }
            }
            @default {
              Checking connection status...
            }
          }
        </p>
      </div>
    }
  </button>
}
