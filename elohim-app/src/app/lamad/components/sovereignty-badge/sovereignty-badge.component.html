<!-- Sovereignty Badge: At-a-Glance View -->
<div class="sovereignty-section">
  <button
    type="button"
    class="sovereignty-header"
    (click)="toggleExpand()"
    [attr.aria-expanded]="expanded()"
  >
    <!-- Stage Icon -->
    <span class="material-icons stage-icon">{{ stageInfo().icon }}</span>

    <!-- Stage Badge -->
    <span class="stage-badge" [ngClass]="getStageBadgeClass()">
      {{ stageInfo().label }}
    </span>

    <!-- Connection Status -->
    <span class="status-indicator">
      <span class="status-dot" [ngClass]="getStatusDotClass()"></span>
      <span class="status-text">{{ connectionStatus().label }}</span>
    </span>

    <!-- Expand Arrow -->
    <span class="material-icons expand-arrow" [class.expanded]="expanded()">expand_more</span>
  </button>

  <!-- Tagline -->
  <p class="stage-tagline">{{ stageInfo().tagline }}</p>

  <!-- Quick Summary -->
  <div class="quick-summary">
    <div class="summary-item">
      <span class="summary-label">Data</span>
      <span class="summary-value">{{ summary().data }}</span>
    </div>
    <div class="summary-item">
      <span class="summary-label">Progress</span>
      <span class="summary-value">{{ summary().progress }}</span>
    </div>
  </div>

  <!-- Expanded Details -->
  <div class="sovereignty-details" *ngIf="expanded()">
    <p class="stage-description">{{ stageInfo().description }}</p>

    <!-- Connection Details (when connected) -->
    <div class="connection-details" *ngIf="connectionStatus().state === 'connected'">
      <div class="detail-row">
        <span class="detail-label">Admin URL</span>
        <span class="detail-value monospace">{{ edgeNodeInfo().adminUrl }}</span>
      </div>

      <div class="detail-row" *ngIf="edgeNodeInfo().agentPubKey">
        <span class="detail-label">Agent Key</span>
        <span class="detail-value monospace">
          {{ truncateHash(edgeNodeInfo().agentPubKey) }}
          <button
            type="button"
            class="copy-btn"
            (click)="copyToClipboard(edgeNodeInfo().agentPubKey!, $event)"
            title="Copy"
          >
            <span class="material-icons">content_copy</span>
          </button>
        </span>
      </div>

      <div class="detail-row" *ngIf="edgeNodeInfo().dnaHash">
        <span class="detail-label">DNA Hash</span>
        <span class="detail-value monospace">
          {{ truncateHash(edgeNodeInfo().dnaHash) }}
          <button
            type="button"
            class="copy-btn"
            (click)="copyToClipboard(edgeNodeInfo().dnaHash!, $event)"
            title="Copy"
          >
            <span class="material-icons">content_copy</span>
          </button>
        </span>
      </div>

      <div class="detail-row" *ngIf="edgeNodeInfo().connectedAt">
        <span class="detail-label">Connected</span>
        <span class="detail-value">{{ edgeNodeInfo().connectedAt?.toLocaleString() }}</span>
      </div>
    </div>

    <!-- Error State -->
    <div class="error-message" *ngIf="connectionStatus().state === 'error'">
      <span class="material-icons">error_outline</span>
      {{ connectionStatus().description }}
    </div>

    <!-- Reconnect Button -->
    <button
      type="button"
      class="reconnect-btn"
      *ngIf="connectionStatus().state === 'error' || connectionStatus().state === 'offline'"
      (click)="onReconnect()"
      [disabled]="connectionStatus().state === 'connecting'"
    >
      <span class="material-icons">refresh</span>
      Connect to Network
    </button>
  </div>

  <!-- Actions -->
  <div class="sovereignty-actions">
    <button type="button" class="action-link" (click)="onViewDetails()">
      View Details
      <span class="material-icons">arrow_forward</span>
    </button>

    <button type="button" class="action-upgrade" *ngIf="canUpgrade()" (click)="onUpgrade()">
      Upgrade
      <span class="material-icons">arrow_upward</span>
    </button>
  </div>
</div>
