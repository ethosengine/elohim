<div class="lamad-home">
  <!-- View Mode Toggle -->
  <nav class="view-mode-bar">
    <div class="view-tabs">
      <button
        class="view-tab"
        [class.active]="viewMode === 'paths'"
        (click)="setViewMode('paths')"
      >
        <span class="tab-icon">ðŸ“š</span>
        Learning Paths
      </button>
      <button
        class="view-tab"
        [class.active]="viewMode === 'explore'"
        (click)="setViewMode('explore')"
      >
        <span class="tab-icon">ðŸŒŽ</span>
        Knowledge Graph
      </button>
    </div>
  </nav>

  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading...</p>
    </div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="error-state">
      <h2>Something went wrong</h2>
      <p>{{ error }}</p>
    </div>
  }

  <!-- Main Content -->
  @if (!isLoading && !error) {
    
    <!-- Active Journey (Priority) -->
    @if (activeFocus) {
      <section class="featured-section">
        <div class="featured-card active-journey">
          <div class="featured-badge">Continue Learning</div>

          <h2 class="featured-title">{{ activeFocus.pathTitle }}</h2>
          <p class="featured-description">
            Next: {{ activeFocus.nextStepTitle || 'Continue your journey' }}
          </p>

          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" [style.width.%]="activeFocus.progressPercent"></div>
            </div>
            <span class="progress-text">{{ activeFocus.progressPercent }}% Complete</span>
          </div>

          <div class="featured-actions">
            <button class="btn btn-primary btn-large" (click)="continueActiveJourney()">
              Resume Journey
            </button>
            <button class="btn btn-secondary" (click)="goToPath(activeFocus.pathId)">
              View Path
            </button>
          </div>
        </div>
      </section>
    }
    <!-- Featured Path (Fallback) -->
    @else if (featuredPath) {
      <section class="featured-section">
        <div class="featured-card">
          <div class="featured-badge">Featured Journey</div>

          <h2 class="featured-title">{{ featuredPath.title }}</h2>
          <p class="featured-description">{{ featuredPath.description }}</p>

          <div class="featured-meta">
            <span class="meta-item difficulty" [class]="getDifficultyClass(featuredPath.difficulty)">
              {{ formatDifficulty(featuredPath.difficulty) }}
            </span>
            @if (featuredPath.estimatedDuration) {
              <span class="meta-item duration">{{ featuredPath.estimatedDuration }}</span>
            }
            @if (featuredPath.stepCount) {
              <span class="meta-item steps">{{ featuredPath.stepCount }} steps</span>
            }
          </div>

          <div class="featured-actions">
            <button class="btn btn-primary btn-large" (click)="startFeaturedPath()">
              Begin Journey
            </button>
            <button class="btn btn-secondary" (click)="goToPath(featuredPath.id)">
              View Details
            </button>
          </div>
        </div>
      </section>
    }

    <!-- Paths Section -->
    @if (paths.length > 0) {
      <section class="paths-section">
        <div class="section-header">
          <h2 class="section-title">
            {{ showAllPaths ? 'All Paths' : 'Featured Paths' }}
            @if (!showAllPaths && hasMorePaths) {
              <span class="path-count">({{ totalPathCount }} total)</span>
            }
          </h2>
          @if (hasMorePaths) {
            <button class="btn btn-text" (click)="toggleShowAllPaths()">
              {{ showAllPaths ? 'Show Featured' : 'View All Paths' }}
            </button>
          }
        </div>

        <div class="paths-grid">
          @for (path of paths; track path.id) {
            <button class="path-card" (click)="goToPath(path.id)" type="button">
              @if (path.thumbnailUrl) {
                <div class="path-thumbnail">
                  <img [src]="path.thumbnailUrl" [alt]="path.thumbnailAlt || path.title" loading="lazy">
                </div>
              }
              <div class="path-content">
                <div class="path-header">
                  <h3 class="path-title">{{ path.title }}</h3>
                  @if (getPathProgress(path.id) !== null) {
                    <span class="path-progress-text">{{ getPathProgress(path.id) }}%</span>
                  }
                </div>
                <p class="path-description">{{ path.description }}</p>

                <div class="path-meta">
                  <span class="meta-item difficulty" [class]="getDifficultyClass(path.difficulty)">
                    {{ formatDifficulty(path.difficulty) }}
                  </span>
                  @if (path.stepCount) {
                    <span class="meta-item">{{ path.stepCount }} steps</span>
                  }
                </div>

                @if (path.tags && path.tags.length > 0) {
                  <div class="path-tags">
                    @for (tag of path.tags.slice(0, 3); track tag) {
                      <span class="tag">{{ tag }}</span>
                    }
                  </div>
                }
              </div>
            </button>
          }
        </div>
      </section>
    }

    <!-- Footer -->
    <footer class="home-footer">
      <p>
        Lamad is part of the <strong>Elohim Protocol</strong> - digital infrastructure for human flourishing.
      </p>
    </footer>
  }
</div>
