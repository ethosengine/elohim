<div class="path-overview">
  <!-- Loading State -->
  @if (isLoading) {
    <div class="loading-state">
      <div class="loading-spinner"></div>
      <p>Loading path...</p>
    </div>
  }

  <!-- Error State -->
  @if (error) {
    <div class="error-state">
      <h2>Unable to load path</h2>
      <p>{{ error }}</p>
      <button class="btn btn-primary" (click)="goHome()">
        Back to Home
      </button>
    </div>
  }

  <!-- Path Content -->
  @if (!isLoading && !error && path) {
    <!-- Back Navigation -->
    <nav class="back-nav">
      <button class="btn-back" (click)="goHome()">
        <span class="icon">&#8592;</span>
        All Paths
      </button>
    </nav>

    <!-- Path Header -->
    <header class="path-header">
      <div class="path-meta">
        <span class="difficulty-badge" [class]="path.difficulty">
          {{ getDifficultyDisplay() }}
        </span>
        @if (path.estimatedDuration) {
          <span class="duration">{{ path.estimatedDuration }}</span>
        }
      </div>

      <h1 class="path-title">{{ path.title }}</h1>
      <p class="path-description">{{ path.description }}</p>

      @if (path.purpose) {
        <div class="path-purpose">
          <strong>Purpose:</strong> {{ path.purpose }}
        </div>
      }

      <!-- Tags -->
      @if (path.tags && path.tags.length > 0) {
        <div class="path-tags">
          @for (tag of path.tags; track tag) {
            <span class="tag">{{ tag }}</span>
          }
        </div>
      }
    </header>

    <!-- Progress Section (if started) -->
    @if (hasStarted()) {
      <section class="progress-section">
        <div class="progress-header">
          <h2>Your Progress</h2>
          <span class="progress-percent">{{ getCompletionPercentage() }}% Complete</span>
        </div>
        <div class="progress-bar">
          <div class="progress-fill" [style.width.%]="getCompletionPercentage()"></div>
        </div>
      </section>
    }

    <!-- Action Buttons -->
    <section class="action-section">
      @if (isCompleted()) {
        <div class="completed-message">
          <span class="checkmark">&#10003;</span>
          <span>Path Completed!</span>
        </div>
        <button class="btn btn-secondary" (click)="beginJourney()">
          Review from Start
        </button>
      } @else if (hasStarted()) {
        <button class="btn btn-primary btn-large" (click)="continueJourney()">
          Continue Journey
        </button>
        <button class="btn btn-secondary" (click)="beginJourney()">
          Start from Beginning
        </button>
      } @else {
        <button class="btn btn-primary btn-large" (click)="beginJourney()">
          Begin Journey
        </button>
      }
    </section>

    <!-- Step Outline -->
    <section class="steps-section">
      <h2>Path Outline</h2>
      <p class="steps-count">{{ path.steps.length }} steps</p>

      <ol class="steps-list">
        @for (step of path.steps; track step.order; let i = $index) {
          <li
            class="step-item"
            [class]="getStepStatusClass(i)"
            (click)="goToStep(i)"
            [attr.role]="isStepAccessible(i) ? 'button' : undefined"
            [attr.tabindex]="isStepAccessible(i) ? 0 : undefined"
          >
            <div class="step-indicator">
              @if (isStepCompleted(i)) {
                <span class="checkmark">&#10003;</span>
              } @else if (isStepLocked(i)) {
                <span class="lock">&#128274;</span>
              } @else {
                <span class="number">{{ i + 1 }}</span>
              }
            </div>

            <div class="step-content">
              <h3 class="step-title">{{ step.stepTitle }}</h3>
              @if (!isStepLocked(i) && step.stepNarrative) {
                <p class="step-narrative">{{ step.stepNarrative }}</p>
              }
              @if (isStepLocked(i)) {
                <p class="step-locked-message">Complete previous steps to unlock</p>
              }
              <div class="step-meta">
                @if (step.estimatedTime) {
                  <span class="time">{{ step.estimatedTime }}</span>
                }
                @if (step.optional) {
                  <span class="optional-badge">Optional</span>
                }
              </div>
            </div>

            @if (isStepAccessible(i) && !isStepCompleted(i)) {
              <span class="step-arrow">&#8594;</span>
            }
          </li>
        }
      </ol>
    </section>

    <!-- Path Metadata Footer -->
    <footer class="path-footer">
      <div class="meta-item">
        <span class="meta-label">Created by</span>
        <span class="meta-value">{{ path.createdBy }}</span>
      </div>
      @if (path.attestationsGranted && path.attestationsGranted.length > 0) {
        <div class="meta-item">
          <span class="meta-label">Attestations</span>
          <span class="meta-value">{{ path.attestationsGranted.join(', ') }}</span>
        </div>
      }
    </footer>
  }
</div>
